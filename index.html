<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistem Pemesanan Bahan Ajar SITTA - Universitas Terbuka">
    <title>SITTA - Sistem Pemesanan Bahan Ajar UT</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/sidebar.css">
</head>
<body>
    <!-- =====================================================
         AUTH PAGE (Login/Register)
         ===================================================== -->
    <div id="authPage" class="auth-page">
        <div class="auth-container">
            <div class="auth-logo">
                <img src="https://www.ut.ac.id/wp-content/uploads/2023/08/UT_Header.webp" alt="Logo UT" style="max-width: 200px; margin-bottom: 20px;">
                <h1>üéì SITTA</h1>
                <p>Sistem Informasi Toko Buku Terbuka</p>
            </div>

            <!-- Auth Tabs -->
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Register</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required placeholder="email@example.com">
                    <span class="error-message" id="loginEmail-error"></span>
                </div>

                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required placeholder="Min. 6 karakter">
                    <span class="error-message" id="loginPassword-error"></span>
                </div>

                <button type="submit" class="btn btn-primary btn-block">Login</button>
                
                <div class="auth-footer">
                    <button type="button" class="btn-link" onclick="showPublicTracking()">
                        üì¶ Lacak Pesanan Saya
                    </button>
                </div>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label for="regNama">Nama Lengkap</label>
                    <input type="text" id="regNama" required>
                    <span class="error-message" id="regNama-error"></span>
                </div>

                <div class="form-group">
                    <label for="regNIM">NIM (9 digit)</label>
                    <input type="text" id="regNIM" required maxlength="9" placeholder="123456789">
                    <span class="error-message" id="regNIM-error"></span>
                </div>

                <div class="form-group">
                    <label for="regEmail">Email</label>
                    <input type="email" id="regEmail" required>
                    <span class="error-message" id="regEmail-error"></span>
                </div>

                <div class="form-group">
                    <label for="regTelepon">Nomor Telepon</label>
                    <input type="tel" id="regTelepon" required placeholder="08xxxxxxxxxx">
                    <span class="error-message" id="regTelepon-error"></span>
                </div>

                <div class="form-group">
                    <label for="regPassword">Password</label>
                    <input type="password" id="regPassword" required>
                    <span class="error-message" id="regPassword-error"></span>
                </div>

                <div class="form-group">
                    <label for="regConfirmPassword">Konfirmasi Password</label>
                    <input type="password" id="regConfirmPassword" required>
                    <span class="error-message" id="regConfirmPassword-error"></span>
                </div>

                <button type="submit" class="btn btn-primary btn-block">Register</button>
            </form>
        </div>
    </div>

    <!-- =====================================================
         PUBLIC TRACKING PAGE (Tanpa Login)
         ===================================================== -->
    <div id="publicTrackingPage" style="display: none;" class="auth-page">
        <div class="auth-container">
            <div class="auth-logo">
                <img src="https://www.ut.ac.id/wp-content/uploads/2023/08/UT_Header.webp" alt="Logo UT" style="max-width: 200px; margin-bottom: 20px;">
                <h1>üì¶ Lacak Pesanan</h1>
                <p>Cek status pengiriman tanpa login</p>
            </div>

            <div class="form-group">
                <label for="trackingSearchInput">No. Pesanan atau No. Resi</label>
                <input type="text" id="trackingSearchInput" placeholder="Contoh: ORD123... atau RESI123...">
            </div>

            <button class="btn btn-primary btn-block" onclick="searchPublicTracking()">
                üîç Cari Pesanan
            </button>

            <div id="trackingResult" style="margin-top: 20px;">
                <!-- Result will be shown here -->
            </div>

            <button class="btn btn-outline btn-block" onclick="backToAuth()" style="margin-top: 20px;">
                ‚Üê Kembali ke Login
            </button>
        </div>
    </div>

    <!-- =====================================================
         MAIN APP (With Sidebar Layout)
         ===================================================== -->
    <div id="mainApp" style="display: none;">
        <!-- Sidebar (will be loaded from components/header.html) -->
        <div id="sidebarContainer"></div>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Top Header Mobile (will be loaded from components/header.html) -->
            <div id="headerContainer"></div>

            <!-- Page Content (Dynamic) -->
            <div id="pageContent" class="content-wrapper">
                <!-- Pages will be loaded here dynamically -->
            </div>

            <!-- Footer (will be loaded from components/footer.html) -->
            <div id="footerContainer"></div>
        </main>
    </div>

    <!-- =====================================================
         MODALS
         ===================================================== -->

    <!-- Modal for Book Details -->
    <div id="bookModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeBookModal()">&times;</span>
            <div id="bookModalContent">
                <!-- Book details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Modal for Checkout -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeCheckoutModal()">&times;</span>
            <h2>Checkout</h2>
            <form id="checkoutForm" onsubmit="processCheckout(event)">
                <div class="form-field">
                    <label>Alamat Pengiriman <span class="required">*</span></label>
                    <div id="addressSelector">
                        <!-- Addresses will be loaded here -->
                    </div>
                </div>
                <div class="form-field">
                    <label>Catatan Pesanan</label>
                    <textarea id="orderNotes" rows="3" placeholder="Opsional"></textarea>
                </div>
                <div class="checkout-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="checkoutSubtotal">Rp 0</span>
                    </div>
                    <div class="summary-row">
                        <span>Ongkir:</span>
                        <span>Rp 15.000</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="checkoutTotal">Rp 0</span>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Proses Pembayaran</button>
            </form>
        </div>
    </div>

    <!-- Modal for Payment -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closePaymentModal()">&times;</span>
            <h2 style="text-align: center; margin-bottom: 1.5rem;">üí≥ Pembayaran</h2>
            <div id="paymentModalContent">
                <!-- QR Code and payment info will be loaded here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal for Tracking -->
    <div id="trackingModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeTrackingModal()">&times;</span>
            <h2>Tracking Pengiriman</h2>
            <div id="trackingModalContent">
                <!-- Tracking details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Modal for Add/Edit Address -->
    <div id="addressModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeAddressModal()">&times;</span>
            <h2 id="addressModalTitle">Tambah Alamat</h2>
            <form id="addressForm" onsubmit="saveAddress(event)">
                <div class="form-field">
                    <label>Label Alamat <span class="required">*</span></label>
                    <input type="text" id="addressLabel" required placeholder="Contoh: Rumah, Kantor">
                </div>
                <div class="form-field">
                    <label>Nama Penerima <span class="required">*</span></label>
                    <input type="text" id="addressRecipient" required>
                </div>
                <div class="form-field">
                    <label>Nomor Telepon <span class="required">*</span></label>
                    <input type="tel" id="addressPhone" required placeholder="08xxxxxxxxxx">
                </div>
                <div class="form-field">
                    <label>Alamat Lengkap <span class="required">*</span></label>
                    <textarea id="addressStreet" required rows="3" placeholder="Jalan, No. Rumah, RT/RW"></textarea>
                </div>
                <div class="form-field">
                    <label>Kota <span class="required">*</span></label>
                    <input type="text" id="addressCity" required>
                </div>
                <div class="form-field">
                    <label>Provinsi <span class="required">*</span></label>
                    <input type="text" id="addressProvince" required>
                </div>
                <div class="form-field">
                    <label>Kode Pos <span class="required">*</span></label>
                    <input type="text" id="addressPostal" required maxlength="5" placeholder="12345">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn" onclick="closeAddressModal()" style="flex: 1;">Batal</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Simpan Alamat</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Add/Edit Book (Admin) -->
    <div id="bookFormModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeBookFormModal()">&times;</span>
            <h2 id="bookFormTitle">Tambah Buku Baru</h2>
            <form id="bookForm" onsubmit="saveBook(event)">
                <div class="form-field">
                    <label>Kode Buku <span class="required">*</span></label>
                    <input type="text" id="bookCode" required placeholder="Contoh: MSIM4101">
                </div>
                <div class="form-field">
                    <label>Judul Buku <span class="required">*</span></label>
                    <input type="text" id="bookTitle" required>
                </div>
                <div class="form-field">
                    <label>Pengarang <span class="required">*</span></label>
                    <input type="text" id="bookAuthor" required>
                </div>
                <div class="form-field">
                    <label>Program Studi <span class="required">*</span></label>
                    <input type="text" id="bookProdi" required>
                </div>
                <div class="form-field">
                    <label>Semester <span class="required">*</span></label>
                    <select id="bookSemester" required>
                        <option value="">Pilih Semester</option>
                        <option value="1">Semester 1</option>
                        <option value="2">Semester 2</option>
                        <option value="3">Semester 3</option>
                        <option value="4">Semester 4</option>
                        <option value="5">Semester 5</option>
                        <option value="6">Semester 6</option>
                        <option value="7">Semester 7</option>
                        <option value="8">Semester 8</option>
                    </select>
                </div>
                <div class="form-field">
                    <label>Harga (Rp) <span class="required">*</span></label>
                    <input type="number" id="bookPrice" required min="0">
                </div>
                <div class="form-field">
                    <label>Stok <span class="required">*</span></label>
                    <input type="number" id="bookStock" required min="0">
                </div>
                <div class="form-field">
                    <label>URL Gambar <span class="required">*</span></label>
                    <input type="url" id="bookImage" required placeholder="https://...">
                </div>
                <div class="form-field">
                    <label>Deskripsi</label>
                    <textarea id="bookDescription" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn" onclick="closeBookFormModal()" style="flex: 1;">Batal</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Simpan Buku</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Update Order Status (Admin) -->
    <div id="orderStatusModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeOrderStatusModal()">&times;</span>
            <h2>Update Status Pengiriman</h2>
            <form id="orderStatusForm" onsubmit="updateOrderStatus(event)">
                <input type="hidden" id="orderStatusCode">
                <div class="form-field">
                    <label>No. Pesanan</label>
                    <input type="text" id="orderStatusDisplay" readonly>
                </div>
                <div class="form-field">
                    <label>Status Pengiriman <span class="required">*</span></label>
                    <select id="orderStatus" required>
                        <option value="pending">Menunggu Pembayaran</option>
                        <option value="processing">Sedang Diproses</option>
                        <option value="shipped">Dalam Pengiriman</option>
                        <option value="delivered">Terkirim</option>
                    </select>
                </div>
                <div class="form-field">
                    <label>Catatan Update</label>
                    <textarea id="orderStatusNote" rows="3" placeholder="Opsional"></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn" onclick="closeOrderStatusModal()" style="flex: 1;">Batal</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Update Status</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeOrderModal()">&times;</span>
            <h2>Detail Pesanan</h2>
            <div id="orderModalContent">
                <!-- Dynamically filled by showOrderDetail() -->
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="closeOrderModal()">Tutup</button>
            </div>
        </div>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <!-- Data Buku -->
    <script src="js/data.js"></script>
    
    <!-- Main Script -->
    <script src="js/script.js"></script>
    <script src="js/loader.js"></script>
</body>
</html>
